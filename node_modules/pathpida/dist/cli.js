"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.run = void 0;
const minimist_1 = __importDefault(require("minimist"));
const buildTemplate_1 = __importDefault(require("./buildTemplate"));
const getConfig_1 = __importDefault(require("./getConfig"));
const watchInputDir_1 = __importDefault(require("./watchInputDir"));
const writeRouteFile_1 = __importDefault(require("./writeRouteFile"));
const run = async (args) => {
    const argv = (0, minimist_1.default)(args, {
        string: ['version', 'watch', 'enableStatic', 'output', 'ignorePath'],
        alias: { v: 'version', w: 'watch', s: 'enableStatic', o: 'output', p: 'ignorePath' }
    });
    argv.version !== undefined
        ? console.log(`v${require('../package.json').version}`)
        : argv.watch !== undefined
            ? await (async () => {
                const config = await (0, getConfig_1.default)(argv.enableStatic !== undefined, argv.output, argv.ignorePath);
                (0, writeRouteFile_1.default)((0, buildTemplate_1.default)(config));
                if (config.type === 'nextjs') {
                    config.input && (0, watchInputDir_1.default)(config.input, () => (0, writeRouteFile_1.default)((0, buildTemplate_1.default)(config, 'pages')));
                    config.appDir && (0, watchInputDir_1.default)(config.appDir.input, () => (0, writeRouteFile_1.default)((0, buildTemplate_1.default)(config, 'pages')));
                }
                else {
                    (0, watchInputDir_1.default)(config.input, () => (0, writeRouteFile_1.default)((0, buildTemplate_1.default)(config, 'pages')));
                }
                config.staticDir && (0, watchInputDir_1.default)(config.staticDir, () => (0, writeRouteFile_1.default)((0, buildTemplate_1.default)(config, 'static')));
            })()
            : (0, writeRouteFile_1.default)((0, buildTemplate_1.default)(await (0, getConfig_1.default)(argv.enableStatic !== undefined, argv.output, argv.ignorePath)));
};
exports.run = run;
//# sourceMappingURL=cli.js.map